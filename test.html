<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
    svg {
        width: 600;
        height: 500;
    }

    .reveal-if-active{
        opacity: 0;
        max-height: 0;
        overflow: hidden;
        transition: 0.5s;
    }

    input[type="radio"]:checked ~ .reveal-if-active {
        opacity: 1;
        max-height: 100px;
        padding: 10px 20px;
        overflow: visible;

    }
    </style>
</head>

<body>
<h1>Number of SAT Test-takers and SAT Scores by Demographic</h1>
<!-- subject buttons -->
<form id = "subjects">
    <input type="radio" name="subject" value="Test-takers" onclick="createTestTakers()">Test-takers</input>
    <input type="radio" name="subject" value="Math" onclick="createMath()">Math</input>
    <input type="radio" name="subject" value="Verbal" onclick="createVerbal()">Verbal</input>
</form>

<svg width = "600" height = "500"></svg>

<form>
    <div>
        <input type="radio" name="category" value="income" id = "default" checked>Income Bracket</input>
        <div class="reveal-if-active">
            <button type="button" value='Family Income.Less than 20k.'>Below 20k</button>
            <button type="button" value='Family Income.Between 20-40k.'>20k - 40k</button>
            <button type="button" value='Family Income.Between 40-60k.'>40k - 60k</button>
            <button type="button" value='Family Income.Between 60-80k.'>60k - 80k</button>
            <button type="button" value='Family Income.Between 80-100k.'>80k - 100k</button>
            <button type="button" value='Family Income.More than 100k.'>Above 100k</button>
        </div> 
    </div>
    
    <div>
        <input type="radio" name="category" value="gender">Gender</input>
        <div class="reveal-if-active">
            <button type="button" value='Gender.Female.'>Female</button>
            <button type="button" value='Gender.Male.'>Male</button> 
        </div>
    </div>
    
    <div>
        <input type="radio" name="category" value="gpa">GPA</input>
        <div class="reveal-if-active">
            <button type="button" value='GPA.A plus.'>A+</button>
            <button type="button" value='GPA.A.'>A</button>
            <button type="button" value='GPA.A minus.'>A-</button>
            <button type="button" value='GPA.B.'>B</button>
            <button type="button" value='GPA.C.'>C</button>
            <button type="button" value='GPA.D or lower.'>D or lower</button> 
        </div>
    </div> 
</form>
</body>

<script src="http://d3js.org/d3.v6.min.js"></script>

<script>
    var stateNames = ["Alaska", "Alabama", "Arkansas", "American Samoa", "Arizona", "California", "Colorado", "Connecticut", "District of Columbia", "Delaware", "Florida", "Georgia", "Guam", "Hawaii", "Iowa", "Idaho", "Illinois", "Indiana", "Kansas", "Kentucky", "Louisiana", "Massachusetts", "Maryland", "Maine", "Michigan", "Minnesota", "Missouri", "Mississippi", "Montana", "North Carolina", "North Dakota", "Nebraska", "New Hampshire", "New Jersey", "New Mexico", "Nevada", "New York", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Puerto Rico", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Virginia", "Virgin Islands", "Vermont", "Washington", "Wisconsin", "West Virginia", "Wyoming"]; 
    var years = ["2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"];
    var incomes = ['Family Income.Less than 20k.Test-takers', 'Family Income.Between 20-40k.Test-takers', 'Family Income.Between 40-60k.Test-takers', 'Family Income.Between 60-80k.Test-takers', 'Family Income.Between 80-100k.Test-takers', 'Family Income.More than 100k.Test-takers'];
    var genders = ['Gender.Female.Test-takers', 'Gender.Male.Test-takers']

    function buildAxis(value, minY, maxY){
        //do scales
        var svg = d3.select("svg");
        var margin = 200;
        var width = svg.attr("width") - margin;
        var height = svg.attr("height") - margin;

        //make scales
        var xScale = d3.scaleBand().range([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]);

        //idk why but yeh
        var g = svg.append("g")
                .attr("transform", "translate(" + 100 + "," + 100 + ")")
                .attr("class", value);

        //create axes
        xScale.domain(years);
        yScale.domain([minY, maxY]); 
        
        //x axis
        g.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale))
        .append("text")
        .attr("y", height - 250)
        .attr("x", width - 100)
        .attr("text-anchor", "end")
        .attr("stroke", "black")
        .text("Year");

        //y axis
        g.append("g")
        .call(d3.axisLeft(yScale))
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "-5.1em")
        .attr("text-anchor", "end")
        .attr("stroke", "black")
        .text("AVG Number of Testtakers"); 

        return xScale, yScale;
    }

    function createTestTakers(){
        d3.selectAll("svg > *").remove();
        document.getElementById("default").checked = true;
        createIncome("test_takers");
    }

    function createMath(){
        d3.selectAll("svg > *").remove();
        document.getElementById("default").checked = true;
        createIncome("math_scores");
    }

    function createVerbal(){
        d3.selectAll("svg > *").remove();
        document.getElementById("default").checked = true;
        createIncome("verbal_scores");
    }

    function createIncome(value){
        var file = "data/income_" + value + ".csv";
        console.log(file)
        
        d3.csv(file).then(function (data) {
            var columns = data.columns.filter(i => i != 'Year');
            console.log(columns);
           
            /*
            var xScale, yScale;
            if (value === "test_takers"){
                xScale, yScale = buildAxis(value, 0, 1600);
            } else if (value === "math_scores"){
                xScale, yScale = buildAxis(value, 0, 1000);
            } else if (value === "verbal_scores"){
                xScale, yScale = buildAxis(value, 0, 500);
            } else {
                console.log('something bad has occured.');
            }*/
            
        //do scales
        var svg = d3.select("svg");
        var margin = 200;
        var width = svg.attr("width") - margin;
        var height = svg.attr("height") - margin;

        //make scales
        var xScale = d3.scaleBand().range([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]);

        //idk why but yeh
        var g = svg.append("g")
                .attr("transform", "translate(" + 100 + "," + 100 + ")")
                .attr("class", value);

        //create axes
        xScale.domain(years);
        yScale.domain([0, 1600]); 
        
        //x axis
        g.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale))
        .append("text")
        .attr("y", height - 250)
        .attr("x", width - 100)
        .attr("text-anchor", "end")
        .attr("stroke", "black")
        .text("Year");

        //y axis
        g.append("g")
        .call(d3.axisLeft(yScale))
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "-5.1em")
        .attr("text-anchor", "end")
        .attr("stroke", "black")
        .text("AVG Number of Testtakers"); 

            var g = d3.select("g");
            columns.forEach(i => {
                g.append("path")
                    .datum(data)
                    .attr("d", d3.line()
                        .x(function(d) { return xScale(d.Year) })
                        .y(function(d) { return yScale(d[i]) }))
                    .attr("fill", "none")
                    .attr("class", "line")
                    .attr("stroke", "black")
                    .attr("stroke-width", 1.5);    
            });
        })
       

    }
</script>
</html>